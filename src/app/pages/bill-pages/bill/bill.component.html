<h2>
  Rechnungen
</h2>

<div>
  <mat-form-field>
    <input matInput placeholder="Suche" (input)="onSearchChange($event.target.value)">
  </mat-form-field>
</div>

<mat-table [dataSource]="allBills" class="mat-elevation-z8" dense="true" flexsy>

  <ng-container matColumnDef="Id">
    <mat-header-cell *matHeaderCellDef> Id </mat-header-cell>
    <mat-cell *matCellDef="let bill"> {{bill.id}} </mat-cell>
  </ng-container>

  <ng-container matColumnDef="Abgesagt">
    <mat-header-cell *matHeaderCellDef> Abgesagt </mat-header-cell>
      <mat-cell *matCellDef="let bill">
        <ng-template [ngIf]="!bill.cancelled">
          <p>false</p>
        </ng-template>
        <ng-template [ngIf]="bill.cancelled">
          <p>email sent</p>
        </ng-template>
      </mat-cell>
  </ng-container>

  <ng-container matColumnDef="Amount">
    <mat-header-cell *matHeaderCellDef> Amount </mat-header-cell>
    <mat-cell *matCellDef="let bill"> {{bill.amount}} </mat-cell>
  </ng-container>

  <ng-container matColumnDef="Reservation">
    <mat-header-cell *matHeaderCellDef> Reservation </mat-header-cell>
    <mat-cell *matCellDef="let bill">
      <mat-table [dataSource]="bill.reservations" class="mat-elevation-z8" dense="true" flexsy>
        <ng-container matColumnDef="Id">
          <mat-header-cell *matHeaderCellDef> Id </mat-header-cell>
          <mat-cell *matCellDef="let reservation"> {{reservation.id}} </mat-cell>
        </ng-container>

        <ng-container matColumnDef="StartDate">
          <mat-header-cell *matHeaderCellDef> Start Date </mat-header-cell>
          <mat-cell *matCellDef="let reservation"> {{reservation.startDate.split("T")[0]}} </mat-cell>
        </ng-container>

        <ng-container matColumnDef="EndDate">
          <mat-header-cell *matHeaderCellDef> End Date </mat-header-cell>
          <mat-cell *matCellDef="let reservation"> {{reservation.endDate.split("T")[0]}} </mat-cell>
        </ng-container>

        <mat-header-row *matHeaderRowDef="displayedColumnsReservation"></mat-header-row>
        <mat-row *matRowDef="let row; columns: displayedColumnsReservation;"></mat-row>
      </mat-table>

    </mat-cell>
  </ng-container>

  <ng-container matColumnDef="Payment">
    <mat-header-cell *matHeaderCellDef> Payment </mat-header-cell>
    <mat-cell *matCellDef="let bill">
      <mat-table [dataSource]="bill.payments" class="mat-elevation-z8" dense="true" flexsy>
        <ng-container matColumnDef="Id">
          <mat-header-cell *matHeaderCellDef> Id </mat-header-cell>
          <mat-cell *matCellDef="let payment"> {{payment.id}} </mat-cell>
        </ng-container>

        <ng-container matColumnDef="Timestamp">
          <mat-header-cell *matHeaderCellDef> Timestamp </mat-header-cell>
          <mat-cell *matCellDef="let payment"> {{payment.timestamp.split(":")[0].replace("T"," ")}}:{{payment.timestamp.split(":")[1]}} </mat-cell>
        </ng-container>

        <ng-container matColumnDef="EmailSent">
          <mat-header-cell *matHeaderCellDef> Email Sent </mat-header-cell>
          <mat-cell *matCellDef="let payment"> {{payment.emailSent}} </mat-cell>
        </ng-container>

        <mat-header-row *matHeaderRowDef="displayedColumnsPayment"></mat-header-row>
        <mat-row *matRowDef="let row; columns: displayedColumnsPayment;"></mat-row>

      </mat-table>
    </mat-cell>
  </ng-container>

  <ng-container matColumnDef="Reminder">
    <mat-header-cell *matHeaderCellDef> Reminder </mat-header-cell>
    <mat-cell *matCellDef="let bill">
      <mat-table [dataSource]="bill.reminders" class="mat-elevation-z8" dense="true" 
      flexsy>

        <ng-container matColumnDef="Timestamp">
          <mat-header-cell *matHeaderCellDef> Timestamp </mat-header-cell>
          <mat-cell *matCellDef="let reminder"> {{reminder.timestamp.split(":")[0].replace("T"," ")}}:{{reminder.timestamp.split(":")[1]}} </mat-cell>
        </ng-container>

        <ng-container matColumnDef="EmailSent">
          <mat-header-cell *matHeaderCellDef> Email Sent </mat-header-cell>
          <mat-cell *matCellDef="let reminder"> {{reminder.emailSent}} </mat-cell>
        </ng-container>

        <mat-header-row *matHeaderRowDef="displayedColumnsReminder"></mat-header-row>
        <mat-row *matRowDef="let row; columns: displayedColumnsReminder;"></mat-row>
      </mat-table>

      <!--<div>
        <p *ngFor="let reminder of bill.reminders">
         Send date: {{reminder.timestamp}}, email sent: {{reminder.emailSent}}
        </p>
      </div>-->
    </mat-cell>
  </ng-container>

  <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
  <mat-row *matRowDef="let row; columns: displayedColumns;" (click)="openDetailForBill(row)"></mat-row>
</mat-table>

<a class="fabBottomRight" mat-fab routerLink="/bills/add"><mat-icon svgIcon="add"></mat-icon></a>
